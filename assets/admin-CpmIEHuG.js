import{a as e,o as t,r as n,t as r}from"./firebase-B6LBwd9E.js";import{D as i,E as a,S as o,T as s,_ as c,a as l,b as u,c as d,d as f,f as ee,g as te,h as p,i as m,l as h,m as ne,o as g,r as _,s as v,t as y,u as b,v as x,y as S}from"./index.esm-B0-OTnKT.js";import{n as C,r as re}from"./ui_common-Bmq5Fv_e.js";/* empty css              *//* empty css                      */import{t as ie}from"./nav-BxOCraw_.js";var w=`/music-sheet/`,ae=`dmikorogi@gmail.com,`.split(`,`).map(e=>e.trim()).filter(Boolean),oe=`member`;function se(e){return!!e&&!!e.email&&ae.includes(e.email)}var T=e=>document.getElementById(e),E=e=>T(`msg`).textContent=e||``,D=()=>Q?.displayName||Q?.email||Q?.uid||``,O=T(`lastUpdated`),ce=null,le=``,ue=null,de=``;function k(e){return e?e?.seconds==null?e instanceof Date?e.getTime():0:e.seconds*1e3+(e.nanoseconds||0)/1e6:0}function fe(e,t){if(!O)return;if(!e){O.textContent=`更新: --`;return}let n=pe(t),r=e?.toDate?e.toDate():e instanceof Date?e:null;O.textContent=`更新: ${[r?r.toLocaleString():``,n].filter(Boolean).join(` `)||`--`}`}function pe(e){let t=String(e||``).trim();return t?t.includes(`@`)?t.split(`@`)[0]:t:``}function me(){let e=k(ce);k(ue)>=e?fe(ue,de):fe(ce,le)}var A=e=>document.getElementById(e),j=e=>{let t=A(`memberMsg`);t&&(t.textContent=e||``)},M=T(`scheduleSelectionTitle`),N=T(`scheduleSelectionMeta`),P=T(`scheduleToSheet`),F=T(`scheduleDirectorLog`),I=T(`scheduleCommentLog`),L=T(`scheduleReferencePreview`),R=T(`scheduleMeetingTitle`),z=T(`scheduleMeetingMeta`),B=T(`scheduleMeetingLog`),V=null;function H(e){R&&(R.textContent=``),z&&(z.textContent=``),B&&(B.innerHTML=`<div class="muted">${e||`まだメモがありません`}</div>`)}function U(e,t){if(P){if(!e){P.style.display=`none`,P.removeAttribute(`href`);return}P.href=t?`${w}sheet.html?project=${encodeURIComponent(e)}&cue=${encodeURIComponent(t)}`:`${w}sheet.html?project=${encodeURIComponent(e)}`,P.style.display=`inline-flex`}}function he(e){let t=e?.title||`打ち合わせメモ`,n=e?.meetingHtml||``,r=e?.createdAt?.toDate?e.createdAt.toDate():null,i=r?r.toLocaleString():``,a=pe(e?.createdBy||``);R&&(R.textContent=t),z&&(z.textContent=[i,a].filter(Boolean).join(` `)),B&&(B.innerHTML=n?`<div class="logText">${n}</div>`:`<div class="muted">本文がありません</div>`)}function ge(e){if(V&&=(V(),null),!e){H(`案件を選択してください`);return}H(`読み込み中...`),V=p(c(g(n,`projects`,e,`portalLogs`),te(`createdAt`,`desc`),ne(1)),e=>{if(e.empty){H(`まだメモがありません`);return}he(e.docs[0]?.data?.()||{})},e=>{console.error(e),H(`読み込みに失敗しました`)})}function W(e){return String(e||``).replaceAll(`&`,`&amp;`).replaceAll(`<`,`&lt;`).replaceAll(`>`,`&gt;`).replaceAll(`"`,`&quot;`).replaceAll(`'`,`&#039;`)}function G(e){return String(e||``).toLowerCase().replace(/\s+/g,` `).trim()}function _e(e){let t=String(e||``),n=t.indexOf(`__`);if(n<=0)return null;let r=t.slice(0,n).trim(),i=t.slice(n+2).trim();return!r||!i?null:{projectId:r,cueId:i}}function ve(e){let t=(e?.m??``).toString().trim(),n=(e?.scene??``).toString().trim(),r=(e?.demo??``).toString().trim(),i=(e?.v??``).toString().trim(),a=[];return t&&a.push(`#${t}`),n?a.push(n):r?a.push(r):i&&a.push(`v:${i}`),a.join(` `).trim()}function ye(e){let t=String(e||``).match(/https?:\/\/[^\s<>"']+/g);return t?[...new Set(t)]:[]}function be(e){try{let t=new URL(e);if(t.hostname===`youtu.be`)return t.pathname.slice(1)||null;if(t.hostname.includes(`youtube.com`)){let e=t.searchParams.get(`v`);if(e)return e;let n=t.pathname.match(/\/shorts\/([^\/]+)/);if(n)return n[1];let r=t.pathname.match(/\/embed\/([^\/]+)/);if(r)return r[1]}}catch{}return null}function xe(e){let t=String(e||``).trim();if(!t)return`<div class="muted">参考曲はありません</div>`;let n=ye(t),r=n.find(e=>be(e)),i=``;r&&(i=`
      <div class="referenceEmbed" data-provider="youtube">
        <iframe src="https://www.youtube.com/embed/${be(r)}" title="YouTube preview" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen loading="lazy"></iframe>
      </div>
    `);let a=t&&!(n.length===1&&t===n[0])?`<div class="muted">${W(t)}</div>`:``,o=n.length?`<div class="referenceList">${n.map(e=>{let t=W(e);return`<a class="referenceLink" href="${t}" target="_blank" rel="noopener">${t}</a>`}).join(``)}</div>`:``;return`${a}${i}${o}`}function K(e,t=`参考曲はまだありません`){if(L){if(!e||e.length===0){L.innerHTML=`<div class="muted">${t}</div>`;return}L.innerHTML=e.map(e=>`<div class="referenceCard">${e.label?`<div class="muted">${W(e.label)}</div>`:``}${xe(e.value)}</div>`).join(``)}}function q(e,t,n){if(e){if(!t.length){e.innerHTML=`<div class="muted">${n}</div>`;return}e.innerHTML=t.map(e=>{let t=e.cue||{},n=e.at?.toDate?e.at.toDate():null,r=n?n.toLocaleString():``,i=e.by||``,a=[];return t.m!=null&&t.m!==``&&a.push(`#M ${t.m}`),t.scene&&a.push(t.scene),r&&a.push(r),i&&a.push(i),`
      <div class="logItem">
        <div class="logMeta">${W(a.join(` / `))}</div>
        <div class="logText">${W(e.text||``)}</div>
      </div>
    `}).join(``)}}function Se(e,t){let n=[];return e.forEach(e=>{(Array.isArray(e[t])?e[t]:[]).forEach(t=>{t&&!t.archived&&n.push({...t,cue:e})})}),n.sort((e,t)=>(t?.at?.seconds||0)-(e?.at?.seconds||0)),n.slice(0,12)}async function Ce(e={}){let{projectId:t,projectName:r,trackId:i,trackName:a,cueId:o}=e,s=_e(i);if(s?.projectId&&(t=s.projectId),s?.cueId&&(o=s.cueId),!t)return;ge(t),U(t,o);let l=++Ie,u=a||`選択中の曲`;M&&(M.textContent=u),q(F,[],`読み込み中...`),q(I,[],`読み込み中...`),K([],`読み込み中...`);let d=o||i||``;if(d&&t&&d.startsWith(`${t}__`)&&(d=d.slice(t.length+2)),d){let e=await f(b(n,`projects`,t,`cues`,d));if(l!==Ie)return;if(e.exists()){let n={id:d,...e.data()||{}},i=[];n.m!=null&&n.m!==``&&i.push(`#M ${n.m}`),n.scene&&i.push(n.scene),n.demo&&i.push(n.demo);let a=i.join(` / `)||u;if(M&&(M.textContent=a),N){let e=[];r&&e.push(r),t&&e.push(`#${t}`),N.textContent=e.join(` / `)}let o=(n.directorLog||[]).filter(e=>e&&!e.archived).map(e=>({...e,cue:n})).sort((e,t)=>(t?.at?.seconds||0)-(e?.at?.seconds||0)),s=(n.commentLog||[]).filter(e=>e&&!e.archived).map(e=>({...e,cue:n})).sort((e,t)=>(t?.at?.seconds||0)-(e?.at?.seconds||0));q(F,o,`監督FBはまだありません`),q(I,s,`コメントはまだありません`);let c=(n.reference||``).trim();c?K([{value:c}]):K([],`参考曲はまだありません`);return}}let p=await ee(c(g(n,`projects`,t,`cues`),te(`m`)));if(l!==Ie)return;let m=[];p.forEach(e=>m.push({id:e.id,...e.data()||{}}));let h=m,ne=String(a||``).trim(),_=G(ne),v=ne.match(/#\s*(\d+)/),y=v?v[1]:null;if((_||y)&&(h=m.filter(e=>{let t=G(ve(e));return!!(t&&t===_||[e.scene,e.demo,e.memo,e.note,e.v==null?``:`v:${e.v}`,e.m==null?``:`#${e.m}`].filter(Boolean).map(e=>G(e)).join(` `).includes(_)||y&&String(e.m??``)===y)})),N){let e=[];r&&e.push(r),t&&e.push(`#${t}`),a&&e.push(`曲: ${a}`),N.textContent=e.join(` / `)}let x=Se(h,`directorLog`),S=Se(h,`commentLog`);q(F,x,`監督FBはまだありません`),q(I,S,`コメントはまだありません`);let C=h.map(e=>({label:ve(e)||e.id,value:e.reference||``})).filter(e=>String(e.value||``).trim());C.length?K(C):K([],`参考曲はまだありません`)}function J(e){return String(e||``).trim().toLowerCase()}function we(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}function Te(){return`/music-sheet/`}function Ee(e){let t=[],n=(e,r)=>{!e||typeof e!=`object`||Object.entries(e).forEach(([e,i])=>{i===!0?t.push([...r,e].join(`.`)):i&&typeof i==`object`&&n(i,[...r,e])})};return n(e,[]),[...new Set(t)]}function De(e,t){let n=J(t);return n?e&&e[n]===!0?!0:Ee(e).some(e=>J(e)===n):!1}function Y(e){return new y(`memberEmails`,e)}function X(e,t){let r=J(t);return r?b(n,`projects`,e,`invites`,r):null}async function Z(e,t,r,i){let a=X(e,t);if(!a)return;let o=r||D(),s=!1;try{s=(await f(a)).exists()}catch(e){console.warn(`invite doc check failed`,e)}let c=String(i||$.get(e)||``).trim();if(!c)try{let t=await f(b(n,`projects`,e));if(t.exists()){let e=t.data()||{};c=String(e.name||e.projectName||e.title||``).trim()}}catch(e){console.warn(`project name fetch failed`,e)}try{let e={emailLower:J(t),role:oe,createdAt:x(),createdBy:o,...s?{}:{usedBy:null,usedAt:null}};c&&(e.projectName=c),await S(a,e,{merge:!0})}catch(e){console.warn(`invite create failed`,e)}}async function Oe(e,t){let r=String(t||``).trim();if(r)try{let t=await f(b(n,`projects`,e));if(!t.exists())return;let i=t.data()||{},a=Array.isArray(i.memberEmailList)?i.memberEmailList:[],o=Ae(i.memberEmails||{},a),s=D();await Promise.all(o.map(t=>{let n=X(e,t);return n?u(n,{projectName:r,updatedAt:x(),updatedBy:s}).catch(()=>null):null}))}catch(e){console.warn(`invite name sync failed`,e)}}async function ke(e,t){try{let n=Array.isArray(t?.memberEmailList)?t.memberEmailList:[],r=Ae(t?.memberEmails||{},n);await Promise.all(r.map(t=>{let n=X(e,t);return n?d(n).catch(()=>null):null}))}catch(e){console.warn(`invite cleanup failed`,e)}}function Ae(e,t){let n=new Set(Ee(e));return Array.isArray(t)&&t.forEach(e=>{let t=J(e);t&&n.add(t)}),[...n]}async function je(e,t,n){if(!e||!Array.isArray(t)||!t.length)return;let r=Fe.get(e)||new Set,i=new Set(r),a=D();await Promise.all(t.map(t=>{let r=J(t);return!r||i.has(r)?null:(i.add(r),Z(e,r,a,n).catch(e=>{console.warn(`invite sync failed`,e)}))})),Fe.set(e,i)}async function Me(e,t,r,i){if(!e||!t||!r||!i)return;let a=b(n,`projects`,e,`members`,t),s=b(n,`projects`,e,`invites`,i);try{if((await f(a)).exists())return;let e=o(n);e.set(a,{role:oe,emailLower:r,joinedAt:x(),memberUid:t,inviteId:i}),e.update(s,{usedBy:t,usedAt:x()}),await e.commit()}catch(e){console.warn(`member join failed`,e)}}var Q=null,Ne=!1,Pe=null,$=new Map,Fe=new Map,Ie=0;ie({current:`admin`}),re(),window.addEventListener(`themechange`,()=>Le()),q(F,[],`曲名をクリックすると表示されます`),q(I,[],`曲名をクリックすると表示されます`),K([],`曲名をクリックすると表示されます`),H(`案件名をクリックすると表示されます`),U(null),window.addEventListener(`message`,e=>{let t=e.data;if(t){if(t.type===`SCHEDULE_TRACK_SELECT`){Ce(t).catch(e=>{console.error(e),q(F,[],`読み込みに失敗しました`),q(I,[],`読み込みに失敗しました`),K([],`読み込みに失敗しました`)});return}if(t.type===`SCHEDULE_PROJECT_SELECT`){let e=t.projectId||``;ge(e),U(e,null)}}}),T(`btnLogin`)?.addEventListener(`click`,async()=>{await a(r,e)}),T(`btnLogout`)?.addEventListener(`click`,async()=>{await i(r)});function Le(e){let t=document.getElementById(`adminScheduleFrame`),n=document.getElementById(`openSchedule`);if(!t||!n)return;let r=`${w}schedule-admin.html?theme=${C()}${e?`&t=${encodeURIComponent(String(e))}`:``}`;t.src=r+`&embed=1`,n.href=r}function Re(e){Pe&&Pe();let t=b(n,`projects`,e);Pe=p(t,n=>{if(!n.exists()){A(`ownerEmailView`).textContent=`（未作成）`,A(`memberList`).innerHTML=`<div class="muted">プロジェクトドキュメントがありません。「初期化」を押して作ってね。</div>`;return}let r=n.data()||{};A(`ownerEmailView`).textContent=r.ownerEmail||`—`;let i=r.memberEmails||{},a=Array.isArray(r.memberEmailList)?r.memberEmailList:[],o=Ae(i,a).sort();je(e,o,r.name||e).catch(e=>{console.warn(`invite sync error`,e)});let s=o.filter(e=>i[e]!==!0),c=o.filter(e=>!a.includes(e));if((s.length||c.length)&&Q){let e=[];s.forEach(t=>e.push(Y(t),!0)),c.length&&e.push(`memberEmailList`,o),e.push(`updatedAt`,x(),`updatedBy`,D()),u(t,...e).catch(e=>{console.warn(`memberEmails normalize failed`,e)})}if(o.length===0){A(`memberList`).innerHTML=`<div class="muted">メンバーがまだいません</div>`;return}A(`memberList`).innerHTML=o.map(e=>{let t=e.replaceAll(`"`,`&quot;`);return`
        <div style="display:flex;gap:10px;align-items:center;justify-content:space-between;border:1px solid rgba(15,23,42,.10);border-radius:14px;padding:10px;">
          <div style="display:flex;gap:10px;align-items:center;min-width:0;">
            <span class="pill">${t}</span>
          </div>
          <button class="smallBtn" data-act="removeMember" data-email="${t}">削除</button>
        </div>
      `}).join(``)},e=>{console.error(e),j(`メンバー同期エラー: ${e.code||e.message}`)}),A(`memberList`).onclick=async t=>{let r=t.target?.closest(`button[data-act='removeMember']`);if(!r)return;let i=J(r.dataset.email);if(i&&confirm(`${i} をメンバーから削除する？`))try{let t=b(n,`projects`,e);await u(t,Y(i),h(),`memberEmailList`,m(i),`updatedAt`,x(),`updatedBy`,D());try{await u(t,{[`memberEmails.${i}`]:h()})}catch(e){console.warn(`legacy memberEmails cleanup failed`,e)}try{let t=X(e,i);t&&await d(t)}catch(e){console.warn(`invite delete failed`,e)}j(`削除しました`),setTimeout(()=>j(``),1e3)}catch(e){console.error(e),j(`削除失敗: ${e.code||e.message}`)}}}async function ze(e){try{let t=b(n,`projects`,e),r=await f(t),i=J(Q?.email||``),a=Q?.uid||``;if(!i){j(`管理者メールが取れません`);return}if(!r.exists()){let n=D();await S(t,{name:e,ownerEmail:i,memberEmailList:[i],createdAt:x(),createdBy:n,updatedAt:x(),updatedBy:n},{merge:!0}),await u(t,Y(i),!0,`updatedAt`,x(),`updatedBy`,n),await Z(e,i,n,e),await Me(e,a,i,i),j(`プロジェクトdocを作成しました`),setTimeout(()=>j(``),1200);return}let o=r.data()||{},s=[];o.ownerEmail||s.push(`ownerEmail`,i),(!o.memberEmails||!De(o.memberEmails,i))&&s.push(Y(i),!0),s.length?(s.push(`updatedAt`,x(),`updatedBy`,D()),(!Array.isArray(o.memberEmailList)||!o.memberEmailList.includes(i))&&s.push(`memberEmailList`,l(i)),await u(t,...s),await Z(e,i,D(),o.name||e),await Me(e,a,i,i),j(`初期化しました`),setTimeout(()=>j(``),1200)):(j(`初期化は不要でした`),setTimeout(()=>j(``),1200))}catch(e){console.error(e),j(`初期化失敗: ${e.code||e.message}`)}}async function Be(e,t){let r=J(t);if(!we(r)){j(`メール形式が不正です`);return}try{await u(b(n,`projects`,e),Y(r),!0,`memberEmailList`,l(r),`updatedAt`,x(),`updatedBy`,D()),await Z(e,r,void 0,$.get(e)),A(`memberEmailInput`).value=``,j(`追加しました`),setTimeout(()=>j(``),1e3)}catch(e){console.error(e),j(`追加失敗: ${e.code||e.message}`)}}async function Ve(e){let t=`${location.origin}${Te()}index.html`;try{await navigator.clipboard.writeText(t),j(`招待リンクをコピーしました`),setTimeout(()=>j(``),1200)}catch{prompt(`コピーできなかったので、これをコピーしてね`,t)}}function He(e){let t=T(`list`);if(!t)return;let n=e.filter(e=>!e.deleted&&!e.archived),r=e.filter(e=>!e.deleted&&e.archived),i=e.filter(e=>e.deleted),a=(e,t,n)=>t.length?`
      <div style="margin-top:10px;">
        <div class="muted" style="margin-bottom:6px;">${e}</div>
        <div class="list">${t.map(e=>{let t=e.id,r=e.name||t,i=e.archived?`Unarchive`:`Archive`,a=e.archived?`1`:`0`;return`
        <div class="listItem">
          <div>
            <div class="title">${r}</div>
            <div class="muted">id: ${t}</div>
          </div>
          ${n?`
          <div class="btns">
            <a class="btnLink" href="${w}portal.html?project=${t}">ポータル</a>
            <a class="btnLink" href="${w}sheet.html?project=${t}">Music Sheet</a>
            <details class="actionMenu">
              <summary class="smallBtn">設定</summary>
              <div class="actionMenuList">
                <button class="smallBtn" data-act="rename" data-id="${t}" data-name="${encodeURIComponent(r)}">名前変更</button>
                <button class="smallBtn" data-act="archive" data-id="${t}" data-on="${a}">${i}</button>
                <button class="smallBtn danger" data-act="delete" data-id="${t}">消去</button>
              </div>
            </details>
          </div>
        `:``}
        </div>
      `}).join(``)}</div>
      </div>
    `:``;t.innerHTML=a(`プロジェクト`,n,!0)+a(`アーカイブ`,r,!0)+a(`削除済み`,i,!1)}T(`list`)?.addEventListener(`click`,async e=>{let t=e.target.closest(`button[data-act]`);if(!t)return;let r=t.dataset.act,i=t.dataset.id;if(!i)return;if(!Q){alert(`ログインしてね`);return}let a=b(n,`projects`,i),o=D();try{if(r===`rename`){let e=t.dataset.name||``,n=e?decodeURIComponent(e):i,r=prompt(`新しいプロジェクト名を入力してください`,n);if(r===null)return;let s=r.trim();if(!s){alert(`プロジェクト名を入力してください`);return}if(s===n)return;await u(a,{name:s,updatedAt:x(),updatedBy:o}),await Oe(i,s);return}if(r===`archive`){await u(a,{archived:t.dataset.on!==`1`,archivedAt:x(),archivedBy:o,updatedAt:x(),updatedBy:o});return}if(r===`delete`){let e=null;try{let t=await f(a);e=t.exists()?t.data():null}catch(e){console.warn(`project doc read failed`,e)}if(!confirm(`このプロジェクトを「消去（論理削除）」します。よろしいですか？
※データは復元可能です`)||prompt(`最終確認：DELETE と入力してください`)!==`DELETE`)return;await u(a,{deleted:!0,deletedAt:x(),deletedBy:o,updatedAt:x(),updatedBy:o}),e&&await ke(i,e),alert(`消去（論理削除）しました。`);return}}catch(e){console.error(e),alert(`操作失敗: ${e.code||e.message}`)}});async function Ue(){p(g(n,`projects`),e=>{let t=[];e.forEach(e=>t.push({id:e.id,...e.data()||{}})),t.sort((e,t)=>String(e.name||e.id).localeCompare(String(t.name||t.id))),$.clear(),t.forEach(e=>{e?.id&&$.set(e.id,e.name||``)});let n=null,r=``;t.forEach(e=>{let t=e.updatedAt||e.createdAt||null;k(t)>k(n)&&(n=t,r=e.updatedBy||e.createdBy||``)}),ce=n,le=r,me(),He(t)}),p(v(n,`scheduleBoard`),e=>{let t=null,n=``;e.forEach(e=>{let r=e.data()||{},i=r.updatedAt||null;k(i)>k(t)&&(t=i,n=r.updatedBy||``)}),ue=t,de=n,me()}),Le();let e=A(`memberProjectPicker`);p(g(n,`projects`),t=>{let n=[];if(t.forEach(e=>n.push({id:e.id,...e.data()||{}})),n.sort((e,t)=>String(e.name||e.id).localeCompare(String(t.name||t.id))),e){e.innerHTML=n.map(e=>`<option value="${e.id}">${e.name||e.id}</option>`).join(``);let t=localStorage.getItem(`lastProject`),r=n.find(e=>e.id===t)?t:n[0]?.id||``;r&&(e.value=r,localStorage.setItem(`lastProject`,r),Re(r))}}),e?.addEventListener(`change`,()=>{let t=e.value;localStorage.setItem(`lastProject`,t),Re(t)}),A(`btnInitProjectDoc`)?.addEventListener(`click`,()=>{let e=A(`memberProjectPicker`).value;ze(e)}),A(`btnAddMember`)?.addEventListener(`click`,()=>{let e=A(`memberProjectPicker`).value;Be(e,A(`memberEmailInput`).value)}),A(`memberEmailInput`)?.addEventListener(`keydown`,e=>{e.key===`Enter`&&(e.preventDefault(),A(`btnAddMember`)?.click())}),A(`btnCopyInvite`)?.addEventListener(`click`,()=>{let e=A(`memberProjectPicker`).value;Ve(e)})}s(r,async e=>{if(await t(e),Q=e,!se(e)){alert(`このページは管理者専用です。`),e&&await i(r),location.replace(w+`index.html`);return}T(`userPill`).textContent=e.displayName||e.email||e.uid,T(`btnLogin`).style.display=`none`,T(`btnLogout`).style.display=`inline-block`,Ne||(Ne=!0,Ue())}),T(`btnCreate`)?.addEventListener(`click`,async()=>{if(!Q){E(`ログインしてね`);return}let e=J(Q?.email||``);if(!e){E(`Owner email is required.`);return}let t=T(`newName`).value.trim(),r=D();if(!t){E(`プロジェクト名を入れてね`);return}try{let i=await _(g(n,`projects`),{name:t,ownerEmail:e,memberEmailList:[e],createdAt:x(),createdBy:r,updatedAt:x(),updatedBy:r,members:Q?.uid?[Q.uid]:[],roleByUid:Q?.uid?{[Q.uid]:`owner`}:{}});try{await u(i,Y(e),!0)}catch(e){console.warn(`memberEmails owner set failed`,e)}await Z(i.id,e,r,t),await Me(i.id,Q?.uid||``,e,e),E(`作成しました: ${i.id}`)}catch(e){console.error(e),E(`作成失敗: ${e?.code||e?.message||e}`)}});