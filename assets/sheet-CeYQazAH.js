const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/main-DWez_kp2.js","assets/index.esm-BYm7NlOb.js","assets/tabulator_esm-7yQEXY9l.js","assets/tabulator_esm-fleYdbtK.css","assets/style-AGjW_byj.css"])))=>i.map(i=>d[i]);
import{r as e}from"./firebase-DUzmoriO.js";import{c as t,i as n,o as r,p as i,r as a,s as o,v as s}from"./index.esm-BYm7NlOb.js";import{a as c,n as l,t as u}from"./nav-B79d_qBo.js";/* empty css              */var d=`modulepreload`,f=function(e){return`/music-sheet/`+e},p={};const m=function(e,t,n){let r=Promise.resolve();if(t&&t.length>0){let e=document.getElementsByTagName(`link`),i=document.querySelector(`meta[property=csp-nonce]`),a=i?.nonce||i?.getAttribute(`nonce`);function o(e){return Promise.all(e.map(e=>Promise.resolve(e).then(e=>({status:`fulfilled`,value:e}),e=>({status:`rejected`,reason:e}))))}r=o(t.map(t=>{if(t=f(t,n),t in p)return;p[t]=!0;let r=t.endsWith(`.css`),i=r?`[rel="stylesheet"]`:``;if(n)for(let n=e.length-1;n>=0;n--){let i=e[n];if(i.href===t&&(!r||i.rel===`stylesheet`))return}else if(document.querySelector(`link[href="${t}"]${i}`))return;let o=document.createElement(`link`);if(o.rel=r?`stylesheet`:d,r||(o.as=`script`),o.crossOrigin=``,o.href=t,a&&o.setAttribute(`nonce`,a),document.head.appendChild(o),r)return new Promise((e,n)=>{o.addEventListener(`load`,e),o.addEventListener(`error`,()=>n(Error(`Unable to preload CSS for ${t}`)))})}))}function i(e){let t=new Event(`vite:preloadError`,{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return r.then(t=>{for(let e of t||[])e.status===`rejected`&&i(e.reason);return e().catch(i)})};var h=await c(),g=`/music-sheet/`,_=`${g}index.html`;async function v(r){if(!r?.uid)return new Set;try{let a=(await t(i(n(e,`members`),s(`memberUid`,`==`,r.uid)))).docs.map(e=>e.ref.parent.parent?.id).filter(Boolean);return new Set(a)}catch(e){return console.warn(`member project list failed`,e),new Set}}var y=await v(h),{project:b}=l();if(!b)throw location.replace(_),Error(`missing project`);var x=document.getElementById(`projectNamePill`),S=document.getElementById(`projectSwitcher`),C=`dmikorogi@gmail.com,`.split(`,`).map(e=>e.trim()).filter(Boolean);function w(e){return!!e?.email&&C.includes(e.email)}function T(e){return String(e||``).trim().toLowerCase()}function E(e,t,n){if(!e)return!1;if(w(e))return!0;let r=T(e?.email);if(r&&T(t?.ownerEmail)===r)return!0;let i=e?.uid;return!!(i&&Array.isArray(t?.members)&&t.members.includes(i)||i&&t?.roleByUid&&t.roleByUid[i]||n&&y.has(n))}async function D(){if(!S)return!1;if(!h)return S.style.display=`none`,!1;try{let n=[];if(w(h))(await t(a(e,`projects`))).forEach(e=>n.push({id:e.id,...e.data()||{}}));else{let t=[...y];t.length&&(n=(await Promise.all(t.map(async t=>{try{let n=await o(r(e,`projects`,t));if(!n.exists())return null;let i=n.data()||{};return i.deleted||!E(h,i,t)?null:{id:t,...i}}catch(e){return e?.code!==`permission-denied`&&console.warn(`project doc read failed`,e),null}}))).filter(Boolean))}let i=n.filter(e=>!e.deleted&&E(h,e,e.id));if(i.sort((e,t)=>String(e.name||e.id).localeCompare(String(t.name||t.id))),!i.length)return S.style.display=`none`,!1;S.innerHTML=``,i.forEach(e=>{let t=document.createElement(`option`);t.value=e.id,t.textContent=e.name||e.id,S.appendChild(t)});let s=i.find(e=>e.id===b),c=s||i[0];if(c?.id&&(S.value=c.id,x&&(x.textContent=c.name||c.id),!s))return location.replace(`${g}sheet.html?project=${encodeURIComponent(c.id)}`),!0;S.style.display=i.length>1?`inline-flex`:`none`}catch(e){console.error(e),S.style.display=`none`}return!1}S?.addEventListener(`change`,()=>{let e=S.value;!e||e===b||(localStorage.setItem(`lastProject`,e),location.href=`${g}sheet.html?project=${encodeURIComponent(e)}`)});var O=r(e,`projects`,b),k=null;try{k=await o(O)}catch(e){throw console.warn(`project doc read failed`,e),location.replace(_),e}var A=k?.exists()?k.data()||{}:null;if(!A)throw location.replace(_),Error(`project not found`);if(A?.deleted)throw alert(`???????????????????????????????`),location.replace(`${g}account.html`),Error(`deleted project`);if(!E(h,A,b))throw location.replace(_),Error(`not member`);var j=A?.name||b;x&&(x.textContent=j);var M=document.getElementById(`sheetTitle`);if(M&&(M.textContent=`Music Sheet`),document.title=`Music Sheet | ${j}`,await D())throw Error(`project switcher redirected`);u({current:`sheet`,projectId:b,hideAdmin:!w(h)});var N=document.getElementById(`projectId`);N&&(N.value=b,N.disabled=!0),localStorage.setItem(`lastProject`,b),await m(()=>import(`./main-DWez_kp2.js`),__vite__mapDeps([0,1,2,3,4]));