import{n as e,r as t,t as n}from"./firebase-B4G0vEhV.js";import{D as r,E as i,S as a,T as o,_ as s,a as c,b as l,c as u,d,f as ee,g as te,h as f,i as ne,l as p,m,o as h,r as g,s as _,t as v,u as y,v as b,y as x}from"./index.esm-B0-OTnKT.js";import{n as re,r as S}from"./ui_common-C-_HnKRf.js";/* empty css              *//* empty css                      */import{t as ie}from"./nav-Dq8S0w-t.js";var C=`/music-sheet/`,ae=`dmikorogi@gmail.com,`.split(`,`).map(e=>e.trim()).filter(Boolean),oe=`member`;function se(e){return!!e&&!!e.email&&ae.includes(e.email)}var w=e=>document.getElementById(e),T=e=>w(`msg`).textContent=e||``,E=()=>Z?.displayName||Z?.email||Z?.uid||``,ce=w(`lastUpdated`),le=null,ue=``,D=null,de=``;function O(e){return e?e?.seconds==null?e instanceof Date?e.getTime():0:e.seconds*1e3+(e.nanoseconds||0)/1e6:0}function fe(e,t){if(!ce)return;if(!e){ce.textContent=`更新: --`;return}let n=pe(t),r=e?.toDate?e.toDate():e instanceof Date?e:null;ce.textContent=`更新: ${[r?r.toLocaleString():``,n].filter(Boolean).join(` `)||`--`}`}function pe(e){let t=String(e||``).trim();return t?t.includes(`@`)?t.split(`@`)[0]:t:``}function me(){let e=O(le);O(D)>=e?fe(D,de):fe(le,ue)}var k=e=>document.getElementById(e),A=e=>{let t=k(`memberMsg`);t&&(t.textContent=e||``)},j=w(`scheduleSelectionTitle`),M=w(`scheduleSelectionMeta`),N=w(`scheduleToSheet`),P=w(`scheduleDirectorLog`),F=w(`scheduleCommentLog`),I=w(`scheduleReferencePreview`),L=w(`scheduleMeetingTitle`),R=w(`scheduleMeetingMeta`),z=w(`scheduleMeetingLog`),B=null;function V(e){L&&(L.textContent=``),R&&(R.textContent=``),z&&(z.innerHTML=`<div class="muted">${e||`まだメモがありません`}</div>`)}function H(e,t){if(N){if(!e){N.style.display=`none`,N.removeAttribute(`href`);return}N.href=t?`${C}sheet.html?project=${encodeURIComponent(e)}&cue=${encodeURIComponent(t)}`:`${C}sheet.html?project=${encodeURIComponent(e)}`,N.style.display=`inline-flex`}}function he(e){let t=e?.title||`打ち合わせメモ`,n=e?.meetingHtml||``,r=e?.createdAt?.toDate?e.createdAt.toDate():null,i=r?r.toLocaleString():``,a=pe(e?.createdBy||``);L&&(L.textContent=t),R&&(R.textContent=[i,a].filter(Boolean).join(` `)),z&&(z.innerHTML=n?`<div class="logText">${n}</div>`:`<div class="muted">本文がありません</div>`)}function ge(t){if(B&&=(B(),null),!t){V(`案件を選択してください`);return}V(`読み込み中...`),B=f(s(h(e,`projects`,t,`portalLogs`),te(`createdAt`,`desc`),m(1)),e=>{if(e.empty){V(`まだメモがありません`);return}he(e.docs[0]?.data?.()||{})},e=>{console.error(e),V(`読み込みに失敗しました`)})}function U(e){return String(e||``).replaceAll(`&`,`&amp;`).replaceAll(`<`,`&lt;`).replaceAll(`>`,`&gt;`).replaceAll(`"`,`&quot;`).replaceAll(`'`,`&#039;`)}function W(e){return String(e||``).toLowerCase().replace(/\s+/g,` `).trim()}function _e(e){let t=String(e||``),n=t.indexOf(`__`);if(n<=0)return null;let r=t.slice(0,n).trim(),i=t.slice(n+2).trim();return!r||!i?null:{projectId:r,cueId:i}}function ve(e){let t=(e?.m??``).toString().trim(),n=(e?.scene??``).toString().trim(),r=(e?.demo??``).toString().trim(),i=(e?.v??``).toString().trim(),a=[];return t&&a.push(`#${t}`),n?a.push(n):r?a.push(r):i&&a.push(`v:${i}`),a.join(` `).trim()}function ye(e){let t=String(e||``).match(/https?:\/\/[^\s<>"']+/g);return t?[...new Set(t)]:[]}function be(e){try{let t=new URL(e);if(t.hostname===`youtu.be`)return t.pathname.slice(1)||null;if(t.hostname.includes(`youtube.com`)){let e=t.searchParams.get(`v`);if(e)return e;let n=t.pathname.match(/\/shorts\/([^\/]+)/);if(n)return n[1];let r=t.pathname.match(/\/embed\/([^\/]+)/);if(r)return r[1]}}catch{}return null}function xe(e){let t=String(e||``).trim();if(!t)return`<div class="muted">参考曲はありません</div>`;let n=ye(t),r=n.find(e=>be(e)),i=``;r&&(i=`
      <div class="referenceEmbed" data-provider="youtube">
        <iframe src="https://www.youtube.com/embed/${be(r)}" title="YouTube preview" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen loading="lazy"></iframe>
      </div>
    `);let a=t&&!(n.length===1&&t===n[0])?`<div class="muted">${U(t)}</div>`:``,o=n.length?`<div class="referenceList">${n.map(e=>{let t=U(e);return`<a class="referenceLink" href="${t}" target="_blank" rel="noopener">${t}</a>`}).join(``)}</div>`:``;return`${a}${i}${o}`}function G(e,t=`参考曲はまだありません`){if(I){if(!e||e.length===0){I.innerHTML=`<div class="muted">${t}</div>`;return}I.innerHTML=e.map(e=>`<div class="referenceCard">${e.label?`<div class="muted">${U(e.label)}</div>`:``}${xe(e.value)}</div>`).join(``)}}function K(e,t,n){if(e){if(!t.length){e.innerHTML=`<div class="muted">${n}</div>`;return}e.innerHTML=t.map(e=>{let t=e.cue||{},n=e.at?.toDate?e.at.toDate():null,r=n?n.toLocaleString():``,i=e.by||``,a=[];return t.m!=null&&t.m!==``&&a.push(`#M ${t.m}`),t.scene&&a.push(t.scene),r&&a.push(r),i&&a.push(i),`
      <div class="logItem">
        <div class="logMeta">${U(a.join(` / `))}</div>
        <div class="logText">${U(e.text||``)}</div>
      </div>
    `}).join(``)}}function Se(e,t){let n=[];return e.forEach(e=>{(Array.isArray(e[t])?e[t]:[]).forEach(t=>{t&&!t.archived&&n.push({...t,cue:e})})}),n.sort((e,t)=>(t?.at?.seconds||0)-(e?.at?.seconds||0)),n.slice(0,12)}async function Ce(t={}){let{projectId:n,projectName:r,trackId:i,trackName:a,cueId:o}=t,c=_e(i);if(c?.projectId&&(n=c.projectId),c?.cueId&&(o=c.cueId),!n)return;ge(n),H(n,o);let l=++$,u=a||`選択中の曲`;j&&(j.textContent=u),K(P,[],`読み込み中...`),K(F,[],`読み込み中...`),G([],`読み込み中...`);let f=o||i||``;if(f&&n&&f.startsWith(`${n}__`)&&(f=f.slice(n.length+2)),f){let t=await d(y(e,`projects`,n,`cues`,f));if(l!==$)return;if(t.exists()){let e={id:f,...t.data()||{}},i=[];e.m!=null&&e.m!==``&&i.push(`#M ${e.m}`),e.scene&&i.push(e.scene),e.demo&&i.push(e.demo);let a=i.join(` / `)||u;if(j&&(j.textContent=a),M){let e=[];r&&e.push(r),n&&e.push(`#${n}`),M.textContent=e.join(` / `)}let o=(e.directorLog||[]).filter(e=>e&&!e.archived).map(t=>({...t,cue:e})).sort((e,t)=>(t?.at?.seconds||0)-(e?.at?.seconds||0)),s=(e.commentLog||[]).filter(e=>e&&!e.archived).map(t=>({...t,cue:e})).sort((e,t)=>(t?.at?.seconds||0)-(e?.at?.seconds||0));K(P,o,`監督FBはまだありません`),K(F,s,`コメントはまだありません`);let c=(e.reference||``).trim();c?G([{value:c}]):G([],`参考曲はまだありません`);return}}let ne=await ee(s(h(e,`projects`,n,`cues`),te(`m`)));if(l!==$)return;let p=[];ne.forEach(e=>p.push({id:e.id,...e.data()||{}}));let m=p,g=String(a||``).trim(),_=W(g),v=g.match(/#\s*(\d+)/),b=v?v[1]:null;if((_||b)&&(m=p.filter(e=>{let t=W(ve(e));return!!(t&&t===_||[e.scene,e.demo,e.memo,e.note,e.v==null?``:`v:${e.v}`,e.m==null?``:`#${e.m}`].filter(Boolean).map(e=>W(e)).join(` `).includes(_)||b&&String(e.m??``)===b)})),M){let e=[];r&&e.push(r),n&&e.push(`#${n}`),a&&e.push(`曲: ${a}`),M.textContent=e.join(` / `)}let x=Se(m,`directorLog`),re=Se(m,`commentLog`);K(P,x,`監督FBはまだありません`),K(F,re,`コメントはまだありません`);let S=m.map(e=>({label:ve(e)||e.id,value:e.reference||``})).filter(e=>String(e.value||``).trim());S.length?G(S):G([],`参考曲はまだありません`)}function q(e){return String(e||``).trim().toLowerCase()}function we(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}function Te(){return`/music-sheet/`}function Ee(e){let t=[],n=(e,r)=>{!e||typeof e!=`object`||Object.entries(e).forEach(([e,i])=>{i===!0?t.push([...r,e].join(`.`)):i&&typeof i==`object`&&n(i,[...r,e])})};return n(e,[]),[...new Set(t)]}function De(e,t){let n=q(t);return n?e&&e[n]===!0?!0:Ee(e).some(e=>q(e)===n):!1}function J(e){return new v(`memberEmails`,e)}function Y(t,n){let r=q(n);return r?y(e,`projects`,t,`invites`,r):null}async function X(t,n,r,i){let a=Y(t,n);if(!a)return;let o=r||E(),s=!1;try{s=(await d(a)).exists()}catch(e){console.warn(`invite doc check failed`,e)}let c=String(i||Q.get(t)||``).trim();if(!c)try{let n=await d(y(e,`projects`,t));if(n.exists()){let e=n.data()||{};c=String(e.name||e.projectName||e.title||``).trim()}}catch(e){console.warn(`project name fetch failed`,e)}try{let e={emailLower:q(n),role:oe,createdAt:b(),createdBy:o,...s?{}:{usedBy:null,usedAt:null}};c&&(e.projectName=c),await x(a,e,{merge:!0})}catch(e){console.warn(`invite create failed`,e)}}async function Oe(t,n){let r=String(n||``).trim();if(r)try{let n=await d(y(e,`projects`,t));if(!n.exists())return;let i=n.data()||{},a=Array.isArray(i.memberEmailList)?i.memberEmailList:[],o=Ae(i.memberEmails||{},a),s=E();await Promise.all(o.map(e=>{let n=Y(t,e);return n?l(n,{projectName:r,updatedAt:b(),updatedBy:s}).catch(()=>null):null}))}catch(e){console.warn(`invite name sync failed`,e)}}async function ke(e,t){try{let n=Array.isArray(t?.memberEmailList)?t.memberEmailList:[],r=Ae(t?.memberEmails||{},n);await Promise.all(r.map(t=>{let n=Y(e,t);return n?u(n).catch(()=>null):null}))}catch(e){console.warn(`invite cleanup failed`,e)}}function Ae(e,t){let n=new Set(Ee(e));return Array.isArray(t)&&t.forEach(e=>{let t=q(e);t&&n.add(t)}),[...n]}async function je(e,t,n){if(!e||!Array.isArray(t)||!t.length)return;let r=Fe.get(e)||new Set,i=new Set(r),a=E();await Promise.all(t.map(t=>{let r=q(t);return!r||i.has(r)?null:(i.add(r),X(e,r,a,n).catch(e=>{console.warn(`invite sync failed`,e)}))})),Fe.set(e,i)}async function Me(t,n,r,i){if(!t||!n||!r||!i)return;let o=y(e,`projects`,t,`members`,n),s=y(e,`projects`,t,`invites`,i);try{if((await d(o)).exists())return;let t=a(e);t.set(o,{role:oe,emailLower:r,joinedAt:b(),memberUid:n,inviteId:i}),t.update(s,{usedBy:n,usedAt:b()}),await t.commit()}catch(e){console.warn(`member join failed`,e)}}var Z=null,Ne=!1,Pe=null,Q=new Map,Fe=new Map,$=0;ie({current:`admin`}),S(),window.addEventListener(`themechange`,()=>Ie()),K(P,[],`曲名をクリックすると表示されます`),K(F,[],`曲名をクリックすると表示されます`),G([],`曲名をクリックすると表示されます`),V(`案件名をクリックすると表示されます`),H(null),window.addEventListener(`message`,e=>{let t=e.data;if(t){if(t.type===`SCHEDULE_TRACK_SELECT`){Ce(t).catch(e=>{console.error(e),K(P,[],`読み込みに失敗しました`),K(F,[],`読み込みに失敗しました`),G([],`読み込みに失敗しました`)});return}if(t.type===`SCHEDULE_PROJECT_SELECT`){let e=t.projectId||``;ge(e),H(e,null)}}}),w(`btnLogin`)?.addEventListener(`click`,async()=>{await i(n,t)}),w(`btnLogout`)?.addEventListener(`click`,async()=>{await r(n)});function Ie(e){let t=document.getElementById(`adminScheduleFrame`),n=document.getElementById(`openSchedule`);if(!t||!n)return;let r=`${C}schedule-admin.html?theme=${re()}${e?`&t=${encodeURIComponent(String(e))}`:``}`;t.src=r+`&embed=1`,n.href=r}function Le(t){Pe&&Pe();let n=y(e,`projects`,t);Pe=f(n,e=>{if(!e.exists()){k(`ownerEmailView`).textContent=`（未作成）`,k(`memberList`).innerHTML=`<div class="muted">プロジェクトドキュメントがありません。「初期化」を押して作ってね。</div>`;return}let r=e.data()||{};k(`ownerEmailView`).textContent=r.ownerEmail||`—`;let i=r.memberEmails||{},a=Array.isArray(r.memberEmailList)?r.memberEmailList:[],o=Ae(i,a).sort();je(t,o,r.name||t).catch(e=>{console.warn(`invite sync error`,e)});let s=o.filter(e=>i[e]!==!0),c=o.filter(e=>!a.includes(e));if((s.length||c.length)&&Z){let e=[];s.forEach(t=>e.push(J(t),!0)),c.length&&e.push(`memberEmailList`,o),e.push(`updatedAt`,b(),`updatedBy`,E()),l(n,...e).catch(e=>{console.warn(`memberEmails normalize failed`,e)})}if(o.length===0){k(`memberList`).innerHTML=`<div class="muted">メンバーがまだいません</div>`;return}k(`memberList`).innerHTML=o.map(e=>{let t=e.replaceAll(`"`,`&quot;`);return`
        <div style="display:flex;gap:10px;align-items:center;justify-content:space-between;border:1px solid rgba(15,23,42,.10);border-radius:14px;padding:10px;">
          <div style="display:flex;gap:10px;align-items:center;min-width:0;">
            <span class="pill">${t}</span>
          </div>
          <button class="smallBtn" data-act="removeMember" data-email="${t}">削除</button>
        </div>
      `}).join(``)},e=>{console.error(e),A(`メンバー同期エラー: ${e.code||e.message}`)}),k(`memberList`).onclick=async n=>{let r=n.target?.closest(`button[data-act='removeMember']`);if(!r)return;let i=q(r.dataset.email);if(i&&confirm(`${i} をメンバーから削除する？`))try{let n=y(e,`projects`,t);await l(n,J(i),p(),`memberEmailList`,ne(i),`updatedAt`,b(),`updatedBy`,E());try{await l(n,{[`memberEmails.${i}`]:p()})}catch(e){console.warn(`legacy memberEmails cleanup failed`,e)}try{let e=Y(t,i);e&&await u(e)}catch(e){console.warn(`invite delete failed`,e)}A(`削除しました`),setTimeout(()=>A(``),1e3)}catch(e){console.error(e),A(`削除失敗: ${e.code||e.message}`)}}}async function Re(t){try{let n=y(e,`projects`,t),r=await d(n),i=q(Z?.email||``),a=Z?.uid||``;if(!i){A(`管理者メールが取れません`);return}if(!r.exists()){let e=E();await x(n,{name:t,ownerEmail:i,memberEmailList:[i],createdAt:b(),createdBy:e,updatedAt:b(),updatedBy:e},{merge:!0}),await l(n,J(i),!0,`updatedAt`,b(),`updatedBy`,e),await X(t,i,e,t),await Me(t,a,i,i),A(`プロジェクトdocを作成しました`),setTimeout(()=>A(``),1200);return}let o=r.data()||{},s=[];o.ownerEmail||s.push(`ownerEmail`,i),(!o.memberEmails||!De(o.memberEmails,i))&&s.push(J(i),!0),s.length?(s.push(`updatedAt`,b(),`updatedBy`,E()),(!Array.isArray(o.memberEmailList)||!o.memberEmailList.includes(i))&&s.push(`memberEmailList`,c(i)),await l(n,...s),await X(t,i,E(),o.name||t),await Me(t,a,i,i),A(`初期化しました`),setTimeout(()=>A(``),1200)):(A(`初期化は不要でした`),setTimeout(()=>A(``),1200))}catch(e){console.error(e),A(`初期化失敗: ${e.code||e.message}`)}}async function ze(t,n){let r=q(n);if(!we(r)){A(`メール形式が不正です`);return}try{await l(y(e,`projects`,t),J(r),!0,`memberEmailList`,c(r),`updatedAt`,b(),`updatedBy`,E()),await X(t,r,void 0,Q.get(t)),k(`memberEmailInput`).value=``,A(`追加しました`),setTimeout(()=>A(``),1e3)}catch(e){console.error(e),A(`追加失敗: ${e.code||e.message}`)}}async function Be(e){let t=`${location.origin}${Te()}index.html`;try{await navigator.clipboard.writeText(t),A(`招待リンクをコピーしました`),setTimeout(()=>A(``),1200)}catch{prompt(`コピーできなかったので、これをコピーしてね`,t)}}function Ve(e){let t=w(`list`);if(!t)return;let n=e.filter(e=>!e.deleted&&!e.archived),r=e.filter(e=>!e.deleted&&e.archived),i=e.filter(e=>e.deleted),a=(e,t,n)=>t.length?`
      <div style="margin-top:10px;">
        <div class="muted" style="margin-bottom:6px;">${e}</div>
        <div class="list">${t.map(e=>{let t=e.id,r=e.name||t,i=e.archived?`Unarchive`:`Archive`,a=e.archived?`1`:`0`;return`
        <div class="listItem">
          <div>
            <div class="title">${r}</div>
            <div class="muted">id: ${t}</div>
          </div>
          ${n?`
          <div class="btns">
            <a class="btnLink" href="${C}portal.html?project=${t}">ポータル</a>
            <a class="btnLink" href="${C}sheet.html?project=${t}">Music Sheet</a>
            <details class="actionMenu">
              <summary class="smallBtn">設定</summary>
              <div class="actionMenuList">
                <button class="smallBtn" data-act="rename" data-id="${t}" data-name="${encodeURIComponent(r)}">名前変更</button>
                <button class="smallBtn" data-act="archive" data-id="${t}" data-on="${a}">${i}</button>
                <button class="smallBtn danger" data-act="delete" data-id="${t}">消去</button>
              </div>
            </details>
          </div>
        `:``}
        </div>
      `}).join(``)}</div>
      </div>
    `:``;t.innerHTML=a(`プロジェクト`,n,!0)+a(`アーカイブ`,r,!0)+a(`削除済み`,i,!1)}w(`list`)?.addEventListener(`click`,async t=>{let n=t.target.closest(`button[data-act]`);if(!n)return;let r=n.dataset.act,i=n.dataset.id;if(!i)return;if(!Z){alert(`ログインしてね`);return}let a=y(e,`projects`,i),o=E();try{if(r===`rename`){let e=n.dataset.name||``,t=e?decodeURIComponent(e):i,r=prompt(`新しいプロジェクト名を入力してください`,t);if(r===null)return;let s=r.trim();if(!s){alert(`プロジェクト名を入力してください`);return}if(s===t)return;await l(a,{name:s,updatedAt:b(),updatedBy:o}),await Oe(i,s);return}if(r===`archive`){await l(a,{archived:n.dataset.on!==`1`,archivedAt:b(),archivedBy:o,updatedAt:b(),updatedBy:o});return}if(r===`delete`){let e=null;try{let t=await d(a);e=t.exists()?t.data():null}catch(e){console.warn(`project doc read failed`,e)}if(!confirm(`このプロジェクトを「消去（論理削除）」します。よろしいですか？
※データは復元可能です`)||prompt(`最終確認：DELETE と入力してください`)!==`DELETE`)return;await l(a,{deleted:!0,deletedAt:b(),deletedBy:o,updatedAt:b(),updatedBy:o}),e&&await ke(i,e),alert(`消去（論理削除）しました。`);return}}catch(e){console.error(e),alert(`操作失敗: ${e.code||e.message}`)}});async function He(){f(h(e,`projects`),e=>{let t=[];e.forEach(e=>t.push({id:e.id,...e.data()||{}})),t.sort((e,t)=>String(e.name||e.id).localeCompare(String(t.name||t.id))),Q.clear(),t.forEach(e=>{e?.id&&Q.set(e.id,e.name||``)});let n=null,r=``;t.forEach(e=>{let t=e.updatedAt||e.createdAt||null;O(t)>O(n)&&(n=t,r=e.updatedBy||e.createdBy||``)}),le=n,ue=r,me(),Ve(t)}),f(_(e,`scheduleBoard`),e=>{let t=null,n=``;e.forEach(e=>{let r=e.data()||{},i=r.updatedAt||null;O(i)>O(t)&&(t=i,n=r.updatedBy||``)}),D=t,de=n,me()}),Ie();let t=k(`memberProjectPicker`);f(h(e,`projects`),e=>{let n=[];if(e.forEach(e=>n.push({id:e.id,...e.data()||{}})),n.sort((e,t)=>String(e.name||e.id).localeCompare(String(t.name||t.id))),t){t.innerHTML=n.map(e=>`<option value="${e.id}">${e.name||e.id}</option>`).join(``);let e=localStorage.getItem(`lastProject`),r=n.find(t=>t.id===e)?e:n[0]?.id||``;r&&(t.value=r,localStorage.setItem(`lastProject`,r),Le(r))}}),t?.addEventListener(`change`,()=>{let e=t.value;localStorage.setItem(`lastProject`,e),Le(e)}),k(`btnInitProjectDoc`)?.addEventListener(`click`,()=>{let e=k(`memberProjectPicker`).value;Re(e)}),k(`btnAddMember`)?.addEventListener(`click`,()=>{let e=k(`memberProjectPicker`).value;ze(e,k(`memberEmailInput`).value)}),k(`memberEmailInput`)?.addEventListener(`keydown`,e=>{e.key===`Enter`&&(e.preventDefault(),k(`btnAddMember`)?.click())}),k(`btnCopyInvite`)?.addEventListener(`click`,()=>{let e=k(`memberProjectPicker`).value;Be(e)})}o(n,async e=>{if(Z=e,!se(e)){alert(`このページは管理者専用です。`),e&&await r(n),location.replace(C+`index.html`);return}w(`userPill`).textContent=e.displayName||e.email||e.uid,w(`btnLogin`).style.display=`none`,w(`btnLogout`).style.display=`inline-block`,Ne||(Ne=!0,He())}),w(`btnCreate`)?.addEventListener(`click`,async()=>{if(!Z){T(`ログインしてね`);return}let t=q(Z?.email||``);if(!t){T(`Owner email is required.`);return}let n=w(`newName`).value.trim(),r=E();if(!n){T(`プロジェクト名を入れてね`);return}try{let i=await g(h(e,`projects`),{name:n,ownerEmail:t,memberEmailList:[t],createdAt:b(),createdBy:r,updatedAt:b(),updatedBy:r,members:Z?.uid?[Z.uid]:[],roleByUid:Z?.uid?{[Z.uid]:`owner`}:{}});try{await l(i,J(t),!0)}catch(e){console.warn(`memberEmails owner set failed`,e)}await X(i.id,t,r,n),await Me(i.id,Z?.uid||``,t,t),T(`作成しました: ${i.id}`)}catch(e){console.error(e),T(`作成失敗: ${e?.code||e?.message||e}`)}});