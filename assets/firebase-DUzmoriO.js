import{D as e,_ as t,b as n,c as r,g as i,h as a,i as o,l as s,n as c,o as l,p as u,r as d,s as f,v as p,x as m}from"./index.esm-BYm7NlOb.js";(function(){let e=document.createElement(`link`).relList;if(e&&e.supports&&e.supports(`modulepreload`))return;for(let e of document.querySelectorAll(`link[rel="modulepreload"]`))n(e);new MutationObserver(e=>{for(let t of e)if(t.type===`childList`)for(let e of t.addedNodes)e.tagName===`LINK`&&e.rel===`modulepreload`&&n(e)}).observe(document,{childList:!0,subtree:!0});function t(e){let t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin===`use-credentials`?t.credentials=`include`:e.crossOrigin===`anonymous`?t.credentials=`omit`:t.credentials=`same-origin`,t}function n(e){if(e.ep)return;e.ep=!0;let n=t(e);fetch(e.href,n)}})();const h=e({apiKey:`AIzaSyCCp7D78NDqKR2c8cbb29BUUE_5qBOaI_U`,authDomain:`msheet-b7efc.firebaseapp.com`,projectId:`msheet-b7efc`,storageBucket:`sheet-b7efc.firebasestorage.app`,messagingSenderId:`398789467878`,appId:`1:398789467878:web:67a33361881568c6b96527`}),g=m(h),_=s(h),v=new n;var y=2;async function b(e){if(!e?.uid)return;let n=l(_,`users`,e.uid),r=await f(n),o=e.email||``,s=o.trim().toLowerCase();r.exists()?await t(n,{lastSeenAt:a(),email:o,emailNorm:s,displayName:e.displayName||null,photoURL:e.photoURL||null}):await i(n,{email:o,emailNorm:s,displayName:e.displayName||null,photoURL:e.photoURL||null,status:`active`,roleGlobal:`user`,plan:`free`,subscriptionStatus:`inactive`,createdAt:a(),lastSeenAt:a()})}async function x(e){if(!e)return!1;let t=await f(l(_,`users`,e));return(t.exists()?t.data():null)?.status===`banned`}async function S(e){if(!e)return`free`;let t=await f(l(_,`users`,e));if(!t.exists())return`free`;let n=t.data()||{};return String(n.plan||`free`).trim()||`free`}async function C(e){let t=e?.uid;if(!t)return 0;let n=await r(u(o(_,`members`),p(`uid`,`==`,t))),i=new Map;return n.forEach(e=>{if(e.data()?.role!==`owner`)return;let t=e.ref.parent.parent?.id;t&&i.set(t,!0)}),i.size}async function w(e){if(!e?.uid)return;let t=await S(e.uid);if(t&&t!==`free`)return;let n=await C(e);if(n>=y){let e=Error(`無料プランではプロジェクトは2件までです。`);throw e.code=`plan-limit`,e.limit=y,e.count=n,e}}async function T({name:e,user:t}){await w(t);let n=await c(d(_,`projects`),{name:e.trim(),ownerUid:t.uid,createdAt:a(),createdBy:t.uid,updatedAt:a(),updatedBy:t.uid});return await i(l(_,`projects`,n.id,`members`,t.uid),{role:`owner`,uid:t.uid,email:t.email||null,displayName:t.displayName||null,createdAt:a(),createdBy:t.uid}),n.id}export{v as a,x as i,T as n,b as o,_ as r,g as t};